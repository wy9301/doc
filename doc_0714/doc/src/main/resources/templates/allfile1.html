<!doctype html >
<html lang="en" class="no-focus" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <meta http-equiv="Content-Type" content="multipart/form-data; charset=utf-8"/>
    <title>在线文档管理系统</title>
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <link rel="shortcut icon" th:href="@{/asserts/image/favicons/favicon.png}"/>
    <link rel="icon" type="image/png" sizes="192x192" th:href="@{/asserts/imgage/favicons/favicon-192x192.png}"/>
    <link rel="apple-touch-icon" sizes="180x180" th:href="@{/asserts/image/favicons/apple-touch-icon-180x180.png}"/>
    <!-- Stylesheets -->
    
    <link rel="stylesheet" id="css-main" th:href="@{/asserts/css/codebase.min.css}">
    <link rel="stylesheet" th:href="@{/asserts/js/plugins/datatables/dataTables.bootstrap4.min.css}">


    <style type="text/css">
        .mycol {
            padding: 0 5px;
        }

        .mytd {
            margin: 0px;
            padding: 0px;
            width: 1px;
        }
    </style>
</head>
<body>
<div id="page-container" class="sidebar-o side-scroll page-header-modern main-content-boxed">
    <!-- Side Overlay-->
    <nav id="sidebar">
        <!-- Sidebar Scroll Container -->
        <div id="sidebar-scroll">
            <!-- Sidebar Content -->
            <div class="sidebar-content">
                <!-- Side Header -->
                <div class="content-header content-header-fullrow px-15">
                    <!-- Mini Mode -->
                    <div class="content-header-section sidebar-mini-visible-b">
                        <!-- Logo -->
                        <span class="content-header-item font-w700 font-size-xl float-left animated fadeIn">
									<span class="text-dual-primary-dark">c</span><span class="text-primary">b</span>
								</span>
                        <!-- END Logo -->
                    </div>
                    <!-- END Mini Mode -->

                    <!-- Normal Mode -->
                    <div class="content-header-section text-center align-parent sidebar-mini-hidden">
                        <!-- Close Sidebar, Visible only on mobile screens -->
                        <!-- Layout API, functionality initialized in Codebase() -> uiApiLayout() -->
                        <button type="button" class="btn btn-circle btn-dual-secondary d-lg-none align-v-r"
                                data-toggle="layout"
                                data-action="sidebar_close">
                            <i class="fa fa-times text-danger"></i>
                        </button>
                        <!-- END Close Sidebar -->

                        <!-- Logo -->
                        <div class="content-header-item">
                                <i class="si si-fire text-primary"></i>
                                <span class="font-size-xl text-dual-primary-dark">在线文档管理</span><span
                                    class="font-size-xl text-primary">系统</span>
                        </div>
                        <!-- END Logo -->
                    </div>
                    <!-- END Normal Mode -->
                </div>
                <!-- END Side Header -->

                <!-- Side User -->
                <div class="content-side content-side-full content-side-user px-10 align-parent">
                    <!-- Visible only in mini mode -->

                    <!-- END Visible only in mini mode -->
                    <!--model-->
                    <!-- upload Modal -->

                    <!--end model-->
                    <!-- Visible only in normal mode -->
                    <div class="sidebar-mini-hidden-b text-center">
                        <a class="img-link">
                            <img class="img-avatar img-avatar64" th:src="@{'/asserts/image/'+${user.getHead()}}" alt=""
                                 data-toggle="modal"
                                 data-target="#head-model">
                        </a>
                        <ul class="list-inline mt-10">
                            <li class="list-inline-item">
                                <a class="link-effect text-dual-primary-dark font-size-xs font-w600 text-uppercase"
                                   th:text="${user.getUsername()}"></a>
                            </li>
                            <li class="list-inline-item">
                                <!-- Layout API, functionality initialized in Codebase() -> uiApiLayout() -->
                                <a class="link-effect text-dual-primary-dark" data-toggle="layout"
                                   data-action="sidebar_style_inverse_toggle"
                                   href="javascript:void(0)">
                                    <i class="si si-drop"></i>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a class="link-effect text-dual-primary-dark" th:href="@{/user/logout}">
                                    <i class="si si-logout"></i>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <!-- END Visible only in normal mode -->
                </div>
                <!-- END Side User -->

                <!-- Side Navigation -->
                <div class="content-side content-side-full">
                    <ul class="nav-main">
                        <li>
                            <a th:href="@{/myfile/list}" class="active"><i class="fa fa-files-o"></i><span
                                    class="sidebar-mini-hide">全部文件</span></a>
                        </li>
                        <li>
                            <a th:href="@{/myfile/share_list}"><i class="fa fa-share-alt"></i><span
                                    class="sidebar-mini-hide">与我共享</span></a>
                        </li>
                        <li>
                            <a th:href="@{/myfile/friend_list}"><i class="fa fa-group"></i><span
                                    class="sidebar-mini-hide">常用联系人</span></a>
                        </li>
                        <li>
                            <a th:href="@{/syfile/file_list}" ><i class="fa fa-briefcase"></i><span
                                    class="sidebar-mini-hide">公共文档</span></a>
                        </li>
                        <li>
                            <a th:href="@{/myfile/recycle_list}" ><i class="fa fa-trash"></i><span
                                    class="sidebar-mini-hide">回收站</span></a>
                        </li>
                    </ul>
                </div>
                <!-- END Side Navigation -->
            </div>
            <!-- Sidebar Content -->
        </div>
        <!-- END Sidebar Scroll Container -->
    </nav>
    <!-- END Sidebar -->

    <!-- Header -->
    <header id="page-header">
        <!-- Header Content -->
        <div class="content-header">
            <!-- Left Section -->
            <div class="content-header-section">
                <!-- Toggle Sidebar -->
                <!-- Layout API, functionality initialized in Codebase() -> uiApiLayout() -->
                <button type="button" class="btn btn-circle btn-dual-secondary" data-toggle="layout"
                        data-action="sidebar_toggle">
                    <i class="fa fa-navicon"></i>
                </button>
                <!-- END Toggle Sidebar -->

                <!-- Open Search Section -->
                <!-- Layout API, functionality initialized in Codebase() -> uiApiLayout() -->
                <button type="button" class="btn btn-circle btn-dual-secondary" data-toggle="layout"
                        data-action="header_search_on">
                    <i class="fa fa-search"></i>
                </button>
                <!-- END Open Search Section -->

                <!-- Layout Options (used just for demonstration) -->
                <!-- Layout API, functionality initialized in Codebase() -> uiApiLayout() -->
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-circle btn-dual-secondary" id="page-header-options-dropdown"
                            data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-wrench"></i>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="page-header-options-dropdown">
                        <h6 class="dropdown-header">Header</h6>
                        <button type="button" class="btn btn-sm btn-block btn-alt-secondary" data-toggle="layout"
                                data-action="header_fixed_toggle">Fixed
                            Mode
                        </button>
                        <button type="button" class="btn btn-sm btn-block btn-alt-secondary d-none d-lg-block mb-10"
                                data-toggle="layout"
                                data-action="header_style_classic">Classic Style
                        </button>
                        <div class="d-none d-xl-block">
                            <h6 class="dropdown-header">Main Content</h6>
                            <button type="button" class="btn btn-sm btn-block btn-alt-secondary mb-10"
                                    data-toggle="layout" data-action="content_layout_toggle">Toggle
                                Layout
                            </button>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="be_layout_api.html">
                            <i class="si si-chemistry"></i> All Options (API)
                        </a>
                    </div>
                </div>
                <!-- END Layout Options -->
            </div>
            <!-- END Left Section -->

            <!-- Right Section -->
            <div class="content-header-section">
                <!-- User Dropdown -->
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-rounded btn-dual-secondary" id="page-header-user-dropdown"
                            data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                        <span th:text="${user.username}"></span>
                        <i class="fa fa-angle-down ml-5"></i>
                    </button>
                    <div class="dropdown-menu dropdown-menu-right min-width-150"
                         aria-labelledby="page-header-user-dropdown">
                        <a class="dropdown-item" href="javascript:void(0)" data-action="side_overlay_toggle"
                           data-toggle="modal"
                           data-target="#psw_model">
                            <i class="si si-wrench mr-5"></i> 修改密码
                        </a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" th:href="@{/user/logout}">
                            <i class="si si-logout mr-5"></i> 退出登录
                        </a>
                    </div>
                </div>
            </div>
            <!-- END Right Section -->
        </div>
        <!-- END Header Content -->

        <!-- Header Search -->
        <div id="page-header-search" class="overlay-header">
            <div class="content-header content-header-fullrow">
                <form th:action="@{/myfile/search}" method="post">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <!-- Close Search Section -->
                            <!-- Layout API, functionality initialized in Codebase() -> uiApiLayout() -->
                            <button type="button" class="btn btn-secondary" data-toggle="layout"
                                    data-action="header_search_off">
                                <i class="fa fa-times"></i>
                            </button>
                            <!-- END Close Search Section -->
                        </div>
                        <input type="text" class="form-control" placeholder="请输入文件名" id="sname" name="sname">
                        <div class="input-group-append">
                            <button type="submit" class="btn btn-secondary">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <!-- END Header Search -->

        <!-- Header Loader -->
        <!-- Please check out the Activity page under Elements category to see examples of showing/hiding it -->
        <div id="page-header-loader" class="overlay-header bg-primary">
            <div class="content-header content-header-fullrow text-center">
                <div class="content-header-item">
                    <i class="fa fa-sun-o fa-spin text-white"></i>
                </div>
            </div>
        </div>
        <!-- END Header Loader -->
    </header>
    <!-- END Header -->


        <!-- Page Content -->
        <div class="content">
            <h2 class="content-heading">全部文件</h2>
            <!-- Full Table -->
            <div class="block">
                <div class="block-header block-header-default">
                    <h3 class="block-title">文件列表</h3>
                    <!-- upload Modal -->
                    <div class="modal" id="modal-normal" tabindex="-1" role="dialog" aria-labelledby="modal-normal"
                         aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <form class="form-horizontal" role="form" th:action="@{/myfile/upload}" method="post"
                                      enctype="multipart/form-data">
                                    <div class="block block-themed block-transparent mb-0">
                                        <div class="block-header bg-primary-dark">
                                            <h3 class="block-title">上传文件</h3>
                                            <div class="block-options">
                                                <button type="button" class="btn-block-option" data-dismiss="modal"
                                                        aria-label="Close">
                                                    <i class="si si-close"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="block-content" style="padding: 20px;">
                                            <input type="file" name="head"/>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-alt-secondary" data-dismiss="modal">Close
                                        </button>
                                        <button type="submit" class="btn btn-alt-success">
                                            上传
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <!-- END upload Modal -->
                    <div class="mycol">
                        <button type="button" class="btn btn-outline-primary mr-5 mb-5" data-toggle="modal"
                                data-target="#modal-normal">
                            <i class="fa fa-upload mr-5"></i>上传
                        </button>
                    </div>
                    <div class="mycol">
                        <button type="button" class="btn btn-outline-danger mr-5 mb-5" onclick="delbatch()">
                            <i class="fa fa-times mr-5"></i>批量删除
                        </button>
                    </div>
                </div>
                <!-- Main Container -->
                <main id="main-container">
                    <!-- Page Content -->
                    <div class="content" style="padding-top: 0px">
                        <!-- Dynamic Table Full -->
                        <div class="block">
                            <div class="block-content block-content-full">
                        <table class="table table-striped table-vcenter js-dataTable-full" id="table_file">
                            <thead>
                            <tr>
                                <th></th>
                                <th class="text-center" style="width: 100px;"><i class="si si-user"></i></th>
                                <th hidden="hidden"></th>
                                <th>文件名</th>
                                <th style="width: 30%;">大小</th>
                                <th style="width: 15%;">更新时间</th>
                                <th class="text-center" style="width: 100px;">操作</th>
                            </tr>
                            </thead>
                            <tbody>

                            <tr th:each="myfile:${list1}">
                                <td class="mytd">
                                    <div class="col-6">
                                        <label class="css-control css-control-secondary css-checkbox">
                                            <input type="checkbox" class="css-control-input" name="del">
                                            <span class="css-control-indicator"></span>
                                        </label>
                                    </div>
                                </td>
                                <td class="text-center">
                                    <img style="width:30px;height: 30px" src="/asserts/image/avatars/download.png"
                                         th:src="@{'/asserts/image/avatars/'+${myfile.category}+'.png'}">
                                </td>
                                <td hidden="hidden" th:text="${myfile.id}">文件号</td>
                                <td class="font-w600" th:text="${myfile.name}">文件名</td>
                                <td th:text="${myfile.size}">文件大小</td>
                                <td>
                                    <span class="badge badge-info" th:text="${myfile.updatetime}">更新时间</span>
                                </td>
                                <td class="text-center">
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-sm btn-secondary" data-toggle="modal"
                                                data-target="#modal-share"
                                                title="共享" onclick="sendcol(this)">
                                            <i class="fa fa-share-alt"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-secondary" data-toggle="tooltip"
                                                title="下载" onclick="download(this)">
                                            <i class="si si-cloud-download"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-secondary " id="btnGroupDrop1"
                                                data-toggle="dropdown"
                                                aria-haspopup="true" aria-expanded="false"><i
                                                class="fa fa-ellipsis-h"></i></button>

                                        <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
<!--                                            <a class="dropdown-item" onclick="ppp(this)">预览</a>-->
                                            <a class="dropdown-item" onclick="changename(this)">重命名</a>
                                            <a class="dropdown-item" onclick="delfile(this)">删除</a>

                                        </div>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                    </div>
                </main>
            </div>
            <!-- END Full Table -->
        </div>
        <!-- END Page Content -->
        <!--model-->
        <div class="modal" id="psw_model" tabindex="-1" role="dialog" aria-labelledby="modal-normal" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <form class="form-horizontal" role="form" th:action="@{/admin/adduser}" method="post">
                        <div class="block block-themed block-transparent mb-0">
                            <div class="block-header bg-primary-dark">
                                <h3 class="block-title">修改密码</h3>
                                <div class="block-options">
                                    <button type="button" class="btn-block-option" data-dismiss="modal"
                                            aria-label="Close">
                                        <i class="si si-close"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="block-content" style="padding-bottom: 10px;">
                                <div class="form-group">
                                    <label>原密码：</label>
                                    <input type="password" class="form-control" value="" placeholder="" id="oldName"
                                           name="oldName" required>
                                </div>
                                <div class="form-group">
                                    <label>新密码：</label>
                                    <input type="password" class="form-control" autocomplete="off" value=""
                                           placeholder="密码" id="password" name="password"
                                           required>
                                </div>
                                <div class="form-group">
                                    <label>新密码确认：</label>
                                    <input type="password" class="form-control" autocomplete="off" placeholder="确认新密码"
                                           id="confirmpwd" name="confirmpwd"
                                           required>
                                </div>
                                <div class="form-group" style="text-align: center;">
                                    <button class="btn btn-primary radius" onClick="ch_psw()" id="submitt"
                                            name="submitt" type="button" value="提交">确认
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!--model end-->

    <!-- END Main Container -->

    <!--model start-->

    <!-- share Modal -->
    <div class="modal" id="modal-share" tabindex="-1" role="dialog" aria-labelledby="modal-large" aria-hidden="true">


        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="block block-themed block-transparent mb-0">
                    <div class="block-header bg-primary-dark">
                        <h3 class="block-title">分享文件</h3>
                        <div class="block-options">
                            <button type="button" class="btn-block-option" data-dismiss="modal" aria-label="Close">
                                <i class="si si-close"></i>
                            </button>
                        </div>
                    </div>
                    <!-- new222 -->

                    <div class="js-chat-container content content-full " data-toggle="appear" data-chat-height="auto">
                        <!-- Multiple Chat (auto height) -->
                        <div class="block mb-0">
                            <ul class="js-chat-head nav nav-tabs nav-tabs-alt bg-body-light" data-toggle="tabs"
                                role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" href="#chat-window1">

                                        <span class="ml-5">分享码分享</span>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#chat-window2">

                                        <span class="ml-5">常用联系人分享</span>
                                    </a>
                                </li>
                            </ul>
                            <div class="tab-content overflow-hidden">
                                <!-- Chat Window #1 -->
                                <div class="tab-pane fade show active" id="chat-window1" role="tabpanel">

                                    <div class="js-chat-form block-content block-content-full block-content-sm bg-body-light">

                                        <div class="row" style="padding: 20px;">
                                            <div class="col-4">
                                                <div class="form-group row">
                                                    <label class="col-lg-6 col-form-label" for="val-skill">有效期: <span
                                                            class="text-danger">*</span></label>
                                                    <div class="col-lg-6">
                                                        <select class="form-control" id="val-skill" name="val-skill">
                                                            <option value="1">1天</option>
                                                            <option value="7">7天</option>
                                                            <option value="0">永久有效</option>
                                                        </select>
                                                    </div>
                                                </div>

                                            </div>
                                            <div class="col-2"></div>
                                            <div class="col-6">
                                                <label class="col-lg-6 col-form-label" for="val-skill" id="code_lab" style="visibility:hidden">分享码:
                                                    <span id="code_value" style="visibility:hidden">111111</span></label>
                                            </div>
                                        </div>

                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-alt-secondary" data-dismiss="modal">
                                                关闭
                                            </button>
                                            <button type="button" class="btn btn-alt-success" onclick="code_share(this)">
                                                <i class="fa fa-check"></i> 生成分享码
                                            </button>
                                        </div>


                                    </div>
                                    <!-- END Chat Input -->
                                </div>
                                <!-- END Chat Window #1 -->

                                <!-- Chat Window #2 -->
                                <div class="tab-pane fade" id="chat-window2" role="tabpanel">
                                    <!-- Messages (demonstration messages are added with JS code at the bottom of this page) -->
                                    <!-- Chat Input -->
                                    <div class="js-chat-form block-content block-content-full block-content-sm bg-body-light">
                                        <div class="block-content" style="max-height: 300px;">
                                            <div class="row">
                                                <div class="col">

                                                    <div class="block">
                                                        <div class="block-header block-header-default"
                                                             style="max-height: 25px;">
                                                            <h3 class="block-title">选择好友分享文件，一次最多50人</h3>
                                                        </div>
                                                        <div class="block-content">
                                                            <div style="overflow:auto;max-height:230px;">
                                                                <table class="table table-vcenter " id="table_all">
                                                                    <tbody>
                                                                    <tr th:each="myfriend:${list2}">
                                                                        <td th:text="${myfriend.id}" hidden="hidden">1
                                                                        </td>
                                                                        <td th:text="${myfriend.username}">Susan Day
                                                                        </td>
                                                                        <td class="text-center">
                                                                            <input type="checkbox" class="mmm"
                                                                                   name="example2"
                                                                                   th:id="${myfriend.id}">
                                                                        </td>
                                                                    </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                                <div class="col">
                                                    <div class="block">
                                                        <div class="block-header block-header-default"
                                                             style="max-height: 20px;">
                                                            <h3 class="block-title">已选择<span id="number-share">0</span>个共享者
                                                            </h3>
                                                        </div>
                                                        <div class="block-content"
                                                             style="overflow:auto;max-height:180px;">
                                                            <table class="table table-vcenter" id="table_share">
                                                            </table>
                                                        </div>
                                                    </div>
                                                    <!-- END Table -->
                                                </div>
                                            </div>
                                        </div>

                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-alt-secondary" data-dismiss="modal" onclick="reflag()">
                                                关闭
                                            </button>
                                            <button type="button" class="btn btn-alt-success" onclick="share()"
                                                    data-dismiss="modal">
                                                <i class="fa fa-check"></i> 分享
                                            </button>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- new222 -->
                </div>


            </div>
        </div>
    </div>
    <!-- END share Modal -->

    <!-- new -->
    <!-- new -->

    <!--uphead model-->
    <div class="modal" id="head-model" tabindex="-1" role="dialog" aria-labelledby="modal-normal" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <form class="form-horizontal" role="form" method="post" enctype="multipart/form-data">
                    <div class="block block-themed block-transparent mb-0">
                        <div class="block-header bg-primary-dark">
                            <h3 class="block-title">上传头像</h3>
                            <div class="block-options">
                                <button type="button" class="btn-block-option" data-dismiss="modal" aria-label="Close"
                                        id="close_model">
                                    <i class="si si-close"></i>
                                </button>
                            </div>
                        </div>
                        <div class="block-content" style="padding-bottom: 10px;">
                            <input type="hidden" name="upid" id="upid" th:value="${user.username}"/>
                            <input type="file" name="uphead" id="uphead"/>
                            <div class="form-group" style="text-align: center;">
                                <button type="button" class="btn btn-alt-primary form-control" onclick="up_head()">上传
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!--uphead model end-->
    <!--model end-->
    <!-- Footer -->
    <footer id="page-footer" class="opacity-0">
        <div class="content py-20 font-size-xs clearfix">
            <div class="float-right">
                <i class="fa fa-flag text-pulse"></i>Crafted by 620
            </div>
            <div class="float-left">
                <a class="font-w600">SDUT 620_DOC</a> &copy; <span class="js-year-copy">2020</span>
            </div>
        </div>
    </footer>
    <!-- END Footer -->
</div>
<!-- END Page Container -->

<!-- Codebase Core JS -->
<script th:src="@{/asserts/js/core/jquery.min.js}"></script>
<script th:src="@{/asserts/js/core/bootstrap.bundle.min.js}"></script>
<script th:src="@{/asserts/js/core/jquery.slimscroll.min.js}"></script>
<script th:src="@{/asserts/js/core/jquery.scrollLock.min.js}"></script>
<script th:src="@{/asserts/js/core/jquery.appear.min.js}"></script>
<script th:src="@{/asserts/js/core/jquery.countTo.min.js}"></script>
<script th:src="@{/asserts/js/core/js.cookie.min.js}"></script>
<script th:src="@{/asserts/js/codebase.js}"></script>

<script th:src="@{/asserts/js/pages/be_comp_chat.js}"></script>
<script th:src="@{/asserts/js/plugins/datatables/jquery.dataTables.min.js}"></script>
<script th:src="@{/asserts/js/plugins/datatables/dataTables.bootstrap4.min.js}"></script>

<!-- Page JS Code -->
<script th:src="@{/asserts/js/pages/be_tables_datatables.js}"></script>

<script language="JavaScript">
    flag_add = 0;
    var old_name = "";
    var share_col = "";

    function ch_psw() {
        var txtconfirm = $.trim($("#confirmpwd").val());
        var txtPwd = $("#password").val();
        if ($.trim(txtconfirm) != $.trim(txtPwd)) {
            alert('你输入的密码不匹配，请从新输入！');
            $("#txtconfirm").focus();
        } else if (txtPwd.length < 6) {
            alert("密码长度需大于等于6位！");
        } else {
            $.ajax({
                type: 'POST',
                url: '/doc/user/change_psw',
                data: {
                    "oldpsw": $("#oldName").val(),
                    "newpsw": txtPwd
                },
                success: function (data) {
                    if (data == "1") {
                        alert("修改成功，请重新登陆");
                        window.location = "/doc/user/index";
                    } else if (data == "0")
                        alert("原密码错误！");
                    $("#oldName").focus();
                },
                error: function () {
                    alert("网络错误，修改失败");
                },
            });
        }
    }

    function up_head() {
        var formData = new FormData();
        formData.append('file', $('#uphead')[0].files[0]); //添加图片信息的参数
        var upid = $('#upid').text();
        $.ajax({
            url: "/doc/user/uphead",
            type: "post",
            data: /*formData,*/ formData,
            processData: false, //因为data值是FormData对象，不需要对数据做处理。
            contentType: false,
            success: function (msg) {
                window.location = "/doc/myfile/list";
            }
        });
    }

    function sendcol(obj) {
        init_code()
        share_col = $(obj).parent().parent().parent().find("td").eq(2).text();
    }

    function changename(obj) {

        var tdd = $(obj).parent().parent().parent().parent().find("td").eq(3);
        old_name = tdd.text();
        var input = $(
            "<form><input type='text'/><button type=\"submit\" class=\"btn btn-sm btn-circle btn-alt-success mr-5 mb-5\" onclick=\"submitname(this)\"><i class=\"fa fa-check\"></i></button><button type=\"button\" class=\"btn btn-sm btn-circle btn-alt-danger mr-5 mb-5\"  onclick=\"oldname(this)\"><i class=\"fa fa-times\"></i></button></form>"
        );
        tdd.html(input);
    }

    function oldname(obj) {
        var tdd = $(obj).parent().parent().parent().find("td").eq(3);
        tdd.html(old_name)
    }

    function submitname(obj) {
        var idd = $(obj).parent().parent().parent().find("td").eq(2).text(); //获取当前行的id
        var name = $(obj).parent().find("input").val();
        $.post("/doc/myfile/changename", {
            id: idd,
            new_name: name
        });
    }

    function download(obj) {
        var idd = $(obj).parent().parent().parent().find("td").eq(2).text(); //获取当前行的id
        url = "/doc/myfile/download?id=" + idd;
        window.open(url);
    }


    function delfile(obj) {

        idd = $(obj).parent().parent().parent().parent().find("td").eq(2).text(); //获取当前行的id
        $.post("/doc/myfile/delete", {
            id: idd,
        }, function () {
            del1($(obj).parent().parent().parent().parent())
        });
    }

    function remove_this(obj) {
        $(obj).parent().parent().parent().remove(); //移除当前行
        flag_add = 0;
    }

    function addfold() {
        if (flag_add == 0) //还没有创立添加栏
        {
            $('#table_file').prepend(
                "<tr><td></td><td></td><td class=\"font-w600\"><form action=\"\" method=\"\"><input type=\"text\" /><button type=\"submit\" class=\"btn btn-sm btn-circle btn-alt-success mr-5 mb-5\"><i class=\"fa fa-check\"></i></button><button type=\"button\" class=\"btn btn-sm btn-circle btn-alt-danger mr-5 mb-5\" onclick=\"remove_this(this)\"><i class=\"fa fa-times\"></i></button></form></td><td></td><td></td><td></td></tr>"
            );
            flag_add = 1;
        }

    }

    function savefold() { //把新建的一行传过去

        $.post("/doc/myfile/addfriend", {
            id: friend,
        }, function (data) {
            flag = 0;
        });
    }
    var flag_codeshare=0;
    function code_share(obj) {
        if(flag_codeshare==0)
        {
            var code_value = $("#code_value");
            var msg="";
            var code_days = $("#val-skill").val();
            $.ajax({
                url:"/doc/gen_code/addcode",
                type: "post",
                data : {
                    "doc_id":share_col,
                    "code_days":code_days
                },
                success: function (msg) {
                    code_value.text(msg);
                    $("#code_lab").css('visibility','visible');
                    code_value.css('visibility','visible');
                    flag_codeshare=1;
                    $(obj).text("复制分享码");
                }
            });
        }else{
            copyText()
        }
    }
    function copyText()
    {
        // var text =$("#code_value").text();
        var div = document.getElementById('code_value');
        if (document.body.createTextRange) {
            var range = document.body.createTextRange();
            range.moveToElementText(div);
            range.select();
        } else if (window.getSelection) {
            var selection = window.getSelection();
            var range = document.createRange();
            range.selectNodeContents(div);
            selection.removeAllRanges();
            selection.addRange(range);
            /*if(selection.setBaseAndExtent){
                selection.setBaseAndExtent(text, 0, text, 1);
            }*/
        } else {
            console.warn("none");
        }
        document.execCommand("Copy"); // 执行浏览器复制命令
        //清除选中
        if (window.getSelection) {
            if (window.getSelection().empty) {// Chrome
                window.getSelection().empty();
            } else if (window.getSelection().removeAllRanges) {// Firefox
                window.getSelection().removeAllRanges();
            }
        } else if (document.selection) {
            // IE?
            document.selection.empty();
        }
    }

    function init_code() {
        flag_codeshare=0;
        $("#code_value").text("")
        $("#code_value").css('visibility','hidden');
        $("#code_lab").css('visibility','hidden');
    }
		/* 常用联系人，点击分享 */
    function share() {
        var str = "";
        $('#table_share tr').each(function (i) { // 遍历 tr
            $(this).children('td').each(function (j) { // 遍历 tr 的各个 td
                if (j == 0) {
                    str += $(this).text() + ",";
                }
            });
        });
        $.post("/doc/myfile/share", {
            str: str,
            share_col: share_col
        }, function () {
            window.location = "/doc/myfile/list";
        });
    }

    function add_friend() {
        var friend = $("#friend").val();
        $.post("/doc/myfile/addfriend", {
            id: friend,
        }, function (data) {
            if (data == "null") {
                alert("未查到该用户！")
            } else {
                alert("添加成功！");
                $("#table_all").append("<tr><td>" + data +
                    "</td><td class=\"text-center\"><input type=\"checkbox\" id=\"defaultCheck\" name=\"example2\"></td></tr>");
                $("#table_share").append("<tr><td>" + data +
                    "</td><td class=\"text-center\"><button type=\"button\" class=\"btn btn-sm btn-secondary\" data-toggle=\"tooltip\" onclick=\"del(this)\"><i class=\"fa fa-times\"></i></button></td></tr>"
                );
                Tlen = $("#table_share").find("tr").length;
                $("#number-share").text(Tlen);
            }
        });
    }

    function del(obj) { //obj定位在button上   右边点击删除,获得groupto,据此删左边
        let gid = $(obj).attr("groupto");
        $(obj).parent().parent().remove(); //移除当前行
        Tlen = $("#table_share").find("tr").length;
        $("#number-share").text(Tlen);
        let todel = $("#" + gid); /* 定位到左边input  */
        todel.prop("checked", false);

    }
    function delbatch() {
        var st = "";
        var checkData = new Array();
        var delSize = $("[name=del]:checked").length;//通过筛选 name=del 且已选中获得的元素对象数组 来得到选中的数量
        var length = 0;
        $("[name=del]:checked").each(function(){//遍历已选中的checked数组
            length++;
            checkData.push($(this).parent().parent().parent().parent().find("td").eq(2).text());
            del1($(this).parent().parent().parent().parent())
        });
        $.post("/doc/myfile/deletelist",
            {
                checkData:checkData
            }, function() {
                // window.location = "/doc/myfile/list";
            })
    }
    function del1(obj) {//假删
        $(obj).remove(); //移除当前行
        Tlen = $("#table_share").find("tr").length;
        $("#number-share").text(Tlen);
    }

    function test() {
        var checks = $('input[type=checkbox]');
        var n = 0;
        for (var i = 0; i < checks.length; i++) {
            if (checks[i].checked) {
                n++
            } else {
            }
        }
        return n
    }

    /*let checks = $("[groupid]");*/
    /* $("[href='#']")  input */
		/* 左边常用联系人框table_all 选取 取消选取 */
    let checks = $(".mmm");
    var Tlen = 0;
    for (let j = 0; j < checks.length; j++) {
        checks[j].onclick = function () {
            let gid = $(checks[j]).attr("id");
            if (checks[j].checked) {
                var obj = checks[j];
								var id= $(obj).parent().parent().find("td").eq(0).text();
                var name = $(obj).parent().parent().find("td").eq(1).text();
                $("#table_share").append("<tr><td hidden=\"hidden\">"+id+"</td><td>" + name +
                    "</td><td class=\"text-center\"><button type=\"button\" class=\"btn btn-sm btn-secondary\" data-toggle=\"tooltip\" onclick=\"del(this)\" groupto=\"" +
                    gid + "\"><i class=\"fa fa-times\"></i></button></td></tr>"
                )
                Tlen = $("#table_share").find("tr").length;
                $("#number-share").text(Tlen);
            } else { //根据gid删右边
                let todel = $("[groupto=" + gid + "]"); /* 定位到右边删除button  */
                /* alert(todel.parent().parent().find("td").eq(0).text()); */
                del1(todel)
            }
        }
    }
    //文件预览

    function ppp(obj) {

        var id = $(obj).parent().parent().parent().parent().find("td").eq(2).text(); //获取当前行的id
        $.ajax({
            type: 'POST',
            async: false,
            url: '/doc/myfile/www',
            dataType: 'text',
            data: {
                "fileName": "6d3222ab-c06d-4819-ba3e-6c38ee6e7bb1.png",
            },
            success: function (responseText) {
                if (responseText == "success") {
                    var curWwwPath = window.document.location.href;
                    var pathName = window.document.location.pathname;
                    var pos = curWwwPath.indexOf(pathName);
                    var localhostPath = curWwwPath.substring(0, pos);
                    //调用pdfjs的viem.html页面来展示获得pdf
                    window.open(localhostPath + "/pdf/web/viewer.html?file=http://localhost:8888/myfile/previewPdf");
                }
            },
            error: function () {
                alert('发生错误');
            }
        });
    };

</script>
</body>
</html>
